<!DOCTYPE html>

<html lang="en" data-content_root="../../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>geniza.pages.models &#8212; Princeton Geniza Project 4.22.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=5ecbeea2" />
    <link rel="stylesheet" type="text/css" href="../../../_static/alabaster.css?v=12dfc556" />
    <script src="../../../_static/documentation_options.js?v=461fad74"></script>
    <script src="../../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for geniza.pages.models</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span><span class="w"> </span><span class="nn">django.db</span><span class="w"> </span><span class="kn">import</span> <span class="n">models</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.http.response</span><span class="w"> </span><span class="kn">import</span> <span class="n">HttpResponseRedirect</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.utils.translation</span><span class="w"> </span><span class="kn">import</span> <span class="n">gettext_lazy</span> <span class="k">as</span> <span class="n">_</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">wagtail.admin.edit_handlers</span><span class="w"> </span><span class="kn">import</span> <span class="n">FieldPanel</span><span class="p">,</span> <span class="n">StreamFieldPanel</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">wagtail.core</span><span class="w"> </span><span class="kn">import</span> <span class="n">blocks</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">wagtail.core.fields</span><span class="w"> </span><span class="kn">import</span> <span class="n">StreamField</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">wagtail.core.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">Page</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">wagtail.documents.blocks</span><span class="w"> </span><span class="kn">import</span> <span class="n">DocumentChooserBlock</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">wagtail.images.blocks</span><span class="w"> </span><span class="kn">import</span> <span class="n">ImageChooserBlock</span>

<span class="c1"># Translators: help text for image alternative text</span>
<span class="n">ALT_TEXT_HELP</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Alternative text for visually impaired users to</span>
<span class="sd">briefly communicate the intended message of the image in this context.&quot;&quot;&quot;</span>
<span class="p">)</span>


<div class="viewcode-block" id="CaptionedImageBlock">
<a class="viewcode-back" href="../../../codedocs/pages.html#geniza.pages.models.CaptionedImageBlock">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">CaptionedImageBlock</span><span class="p">(</span><span class="n">blocks</span><span class="o">.</span><span class="n">StructBlock</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;:class:`~wagtail.core.blocks.StructBlock` for an image with</span>
<span class="sd">    alternative text and optional formatted caption, so</span>
<span class="sd">    that both caption and alternative text can be context-specific.&quot;&quot;&quot;</span>

    <span class="c1"># Adapted from mep-django</span>

    <span class="n">image</span> <span class="o">=</span> <span class="n">ImageChooserBlock</span><span class="p">()</span>
    <span class="n">alternative_text</span> <span class="o">=</span> <span class="n">blocks</span><span class="o">.</span><span class="n">TextBlock</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="n">ALT_TEXT_HELP</span><span class="p">)</span>
    <span class="n">caption</span> <span class="o">=</span> <span class="n">blocks</span><span class="o">.</span><span class="n">RichTextBlock</span><span class="p">(</span>
        <span class="n">features</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;link&quot;</span><span class="p">,</span> <span class="s2">&quot;superscript&quot;</span><span class="p">],</span>
        <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">class</span><span class="w"> </span><span class="nc">Meta</span><span class="p">:</span>
        <span class="n">icon</span> <span class="o">=</span> <span class="s2">&quot;image&quot;</span>
        <span class="n">template</span> <span class="o">=</span> <span class="s2">&quot;pages/blocks/captioned_image_block.html&quot;</span></div>



<div class="viewcode-block" id="SVGImageBlock">
<a class="viewcode-back" href="../../../codedocs/pages.html#geniza.pages.models.SVGImageBlock">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">SVGImageBlock</span><span class="p">(</span><span class="n">blocks</span><span class="o">.</span><span class="n">StructBlock</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;:class:`~wagtail.core.blocks.StructBlock` for an SVG image with</span>
<span class="sd">    alternative text and optional formatted caption. Separate from</span>
<span class="sd">    :class:`CaptionedImageBlock` because Wagtail image handling</span>
<span class="sd">    does not work with SVG.&quot;&quot;&quot;</span>

    <span class="n">extended_description_help</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;This text will only be read to \</span>
<span class="sd">    non-sighted users and should describe the major insights or \</span>
<span class="sd">    takeaways from the graphic. Multiple paragraphs are allowed.&quot;&quot;&quot;</span>
    <span class="p">)</span>

    <span class="c1"># Adapted from mep-django</span>

    <span class="n">image</span> <span class="o">=</span> <span class="n">DocumentChooserBlock</span><span class="p">()</span>
    <span class="n">alternative_text</span> <span class="o">=</span> <span class="n">blocks</span><span class="o">.</span><span class="n">TextBlock</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="n">ALT_TEXT_HELP</span><span class="p">)</span>
    <span class="n">caption</span> <span class="o">=</span> <span class="n">blocks</span><span class="o">.</span><span class="n">RichTextBlock</span><span class="p">(</span>
        <span class="n">features</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;link&quot;</span><span class="p">,</span> <span class="s2">&quot;superscript&quot;</span><span class="p">],</span>
        <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">extended_description</span> <span class="o">=</span> <span class="n">blocks</span><span class="o">.</span><span class="n">RichTextBlock</span><span class="p">(</span>
        <span class="n">features</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;p&quot;</span><span class="p">],</span> <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="n">extended_description_help</span>
    <span class="p">)</span>

    <span class="k">class</span><span class="w"> </span><span class="nc">Meta</span><span class="p">:</span>
        <span class="n">icon</span> <span class="o">=</span> <span class="s2">&quot;image&quot;</span>
        <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;SVG&quot;</span>
        <span class="n">template</span> <span class="o">=</span> <span class="s2">&quot;pages/blocks/svg_image_block.html&quot;</span></div>



<div class="viewcode-block" id="AccordionBlock">
<a class="viewcode-back" href="../../../codedocs/pages.html#geniza.pages.models.AccordionBlock">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">AccordionBlock</span><span class="p">(</span><span class="n">blocks</span><span class="o">.</span><span class="n">StructBlock</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Accordion :class:`~wagtail.core.blocks.StructBlock` for collapsible</span>
<span class="sd">    sections and/or FAQs&quot;&quot;&quot;</span>

    <span class="n">label</span> <span class="o">=</span> <span class="n">blocks</span><span class="o">.</span><span class="n">CharBlock</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Heading label/question&quot;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">content</span> <span class="o">=</span> <span class="n">blocks</span><span class="o">.</span><span class="n">RichTextBlock</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Expanded details/answer&quot;</span><span class="p">,</span>
        <span class="n">features</span><span class="o">=</span><span class="p">[</span>
            <span class="s2">&quot;bold&quot;</span><span class="p">,</span>
            <span class="s2">&quot;italic&quot;</span><span class="p">,</span>
            <span class="s2">&quot;underline&quot;</span><span class="p">,</span>
            <span class="s2">&quot;link&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ol&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ul&quot;</span><span class="p">,</span>
            <span class="s2">&quot;blockquote&quot;</span><span class="p">,</span>
            <span class="s2">&quot;superscript&quot;</span><span class="p">,</span>
            <span class="s2">&quot;subscript&quot;</span><span class="p">,</span>
            <span class="s2">&quot;strikethrough&quot;</span><span class="p">,</span>
        <span class="p">],</span>
        <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">class</span><span class="w"> </span><span class="nc">Meta</span><span class="p">:</span>
        <span class="n">icon</span> <span class="o">=</span> <span class="s2">&quot;folder-open-1&quot;</span>
        <span class="n">template</span> <span class="o">=</span> <span class="s2">&quot;pages/blocks/accordion_block.html&quot;</span>
        <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;Collapsible paragraph (accordion)&quot;</span></div>



<div class="viewcode-block" id="BodyContentBlock">
<a class="viewcode-back" href="../../../codedocs/pages.html#geniza.pages.models.BodyContentBlock">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">BodyContentBlock</span><span class="p">(</span><span class="n">blocks</span><span class="o">.</span><span class="n">StreamBlock</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Common set of content blocks for content pages.&quot;&quot;&quot;</span>

    <span class="c1"># Adapted from mep-django</span>

    <span class="c1"># fields</span>
    <span class="n">paragraph</span> <span class="o">=</span> <span class="n">blocks</span><span class="o">.</span><span class="n">RichTextBlock</span><span class="p">(</span>
        <span class="n">features</span><span class="o">=</span><span class="p">[</span>
            <span class="s2">&quot;h2&quot;</span><span class="p">,</span>
            <span class="s2">&quot;h3&quot;</span><span class="p">,</span>
            <span class="s2">&quot;bold&quot;</span><span class="p">,</span>
            <span class="s2">&quot;italic&quot;</span><span class="p">,</span>
            <span class="s2">&quot;underline&quot;</span><span class="p">,</span>
            <span class="s2">&quot;link&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ol&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ul&quot;</span><span class="p">,</span>
            <span class="s2">&quot;blockquote&quot;</span><span class="p">,</span>
            <span class="s2">&quot;superscript&quot;</span><span class="p">,</span>
            <span class="s2">&quot;subscript&quot;</span><span class="p">,</span>
            <span class="s2">&quot;strikethrough&quot;</span><span class="p">,</span>
        <span class="p">],</span>
        <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">collapsible_paragraph</span> <span class="o">=</span> <span class="n">AccordionBlock</span><span class="p">()</span>
    <span class="n">image</span> <span class="o">=</span> <span class="n">CaptionedImageBlock</span><span class="p">()</span>
    <span class="n">svg_image</span> <span class="o">=</span> <span class="n">SVGImageBlock</span><span class="p">()</span></div>



<div class="viewcode-block" id="HomePage">
<a class="viewcode-back" href="../../../codedocs/pages.html#geniza.pages.models.HomePage">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">HomePage</span><span class="p">(</span><span class="n">Page</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;:class:`wagtail.core.models.Page` model for Geniza home page.&quot;&quot;&quot;</span>

    <span class="c1"># fields</span>
    <span class="n">description</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span><span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">body</span> <span class="o">=</span> <span class="n">StreamField</span><span class="p">(</span><span class="n">BodyContentBlock</span><span class="p">)</span>
    <span class="c1"># can only be child of Root</span>
    <span class="n">parent_page_types</span> <span class="o">=</span> <span class="p">[</span><span class="n">Page</span><span class="p">]</span>
    <span class="n">subpage_types</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;pages.ContentPage&quot;</span><span class="p">,</span> <span class="s2">&quot;pages.ContainerPage&quot;</span><span class="p">]</span>
    <span class="n">content_panels</span> <span class="o">=</span> <span class="n">Page</span><span class="o">.</span><span class="n">content_panels</span> <span class="o">+</span> <span class="p">[</span>
        <span class="n">FieldPanel</span><span class="p">(</span><span class="s2">&quot;description&quot;</span><span class="p">),</span>
        <span class="n">StreamFieldPanel</span><span class="p">(</span><span class="s2">&quot;body&quot;</span><span class="p">),</span>
    <span class="p">]</span>

    <span class="k">class</span><span class="w"> </span><span class="nc">Meta</span><span class="p">:</span>
        <span class="n">verbose_name</span> <span class="o">=</span> <span class="s2">&quot;homepage&quot;</span>

<div class="viewcode-block" id="HomePage.get_context">
<a class="viewcode-back" href="../../../codedocs/pages.html#geniza.pages.models.HomePage.get_context">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_context</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;add page type to context&quot;&quot;&quot;</span>
        <span class="n">context</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">HomePage</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">get_context</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
        <span class="n">context</span><span class="p">[</span><span class="s2">&quot;page_type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;homepage&quot;</span>
        <span class="k">return</span> <span class="n">context</span></div>
</div>



<div class="viewcode-block" id="ContainerPage">
<a class="viewcode-back" href="../../../codedocs/pages.html#geniza.pages.models.ContainerPage">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">ContainerPage</span><span class="p">(</span><span class="n">Page</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;An empty :class:`Page` type that has :class:`ContentPage` instances</span>
<span class="sd">    as its subpages.&quot;&quot;&quot;</span>

    <span class="c1"># can only be child of HomePage</span>
    <span class="n">parent_page_types</span> <span class="o">=</span> <span class="p">[</span><span class="n">HomePage</span><span class="p">]</span>
    <span class="n">subpage_types</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;pages.ContentPage&quot;</span><span class="p">]</span>

    <span class="c1"># show in menu by default</span>
    <span class="n">show_in_menus_default</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="c1"># should not ever actually render</span>
<div class="viewcode-block" id="ContainerPage.serve">
<a class="viewcode-back" href="../../../codedocs/pages.html#geniza.pages.models.ContainerPage.serve">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">serve</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;override serve method to redirect to parent page instead of rendering&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_parent</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_parent</span><span class="p">()</span><span class="o">.</span><span class="n">get_url</span><span class="p">(</span><span class="n">request</span><span class="p">))</span></div>
</div>



<div class="viewcode-block" id="ContentPage">
<a class="viewcode-back" href="../../../codedocs/pages.html#geniza.pages.models.ContentPage">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">ContentPage</span><span class="p">(</span><span class="n">Page</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A simple :class:`Page` type for content pages.&quot;&quot;&quot;</span>

    <span class="c1"># fields</span>
    <span class="n">description</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span><span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">body</span> <span class="o">=</span> <span class="n">StreamField</span><span class="p">(</span><span class="n">BodyContentBlock</span><span class="p">)</span>
    <span class="c1"># can be child of Home or Container page</span>
    <span class="n">parent_page_types</span> <span class="o">=</span> <span class="p">[</span><span class="n">HomePage</span><span class="p">,</span> <span class="n">ContainerPage</span><span class="p">]</span>
    <span class="n">content_panels</span> <span class="o">=</span> <span class="n">Page</span><span class="o">.</span><span class="n">content_panels</span> <span class="o">+</span> <span class="p">[</span>
        <span class="n">FieldPanel</span><span class="p">(</span><span class="s2">&quot;description&quot;</span><span class="p">),</span>
        <span class="n">StreamFieldPanel</span><span class="p">(</span><span class="s2">&quot;body&quot;</span><span class="p">),</span>
    <span class="p">]</span>

    <span class="c1"># show in menu by default</span>
    <span class="n">show_in_menus_default</span> <span class="o">=</span> <span class="kc">True</span>

<div class="viewcode-block" id="ContentPage.get_context">
<a class="viewcode-back" href="../../../codedocs/pages.html#geniza.pages.models.ContentPage.get_context">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_context</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;add page type to context&quot;&quot;&quot;</span>
        <span class="n">context</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">ContentPage</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">get_context</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
        <span class="n">context</span><span class="p">[</span><span class="s2">&quot;page_type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;content-page&quot;</span>
        <span class="k">return</span> <span class="n">context</span></div>
</div>

</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../../index.html">Princeton Geniza Project</a></h1>



<p class="blurb">Django web application and other code for Princeton Geniza Project v4.x</p>




<p>
<iframe src="https://ghbtns.com/github-btn.html?user=Princeton-CDH&repo=geniza&type=watch&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>







    

<p>
<a class="badge" href="https://codecov.io/github/Princeton-CDH/geniza">
    <img
    alt="https://codecov.io/github/Princeton-CDH/geniza/coverage.svg?branch=master"
    src="https://codecov.io/github/Princeton-CDH/geniza/coverage.svg?branch=master"
    />
</a>
</p>
<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../architecture.html">Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../codedocs/index.html">Code Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../devnotes.html">Developer Instructions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../changelog.html">Change Log</a></li>
</ul>


<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script><div class="powered_by">
    <p>Powered by:</p>
    <a href="http://cdh.princeton.edu/">
        <img src="https://cdh.princeton.edu/static/img/CDH_logo.svg"
            alt="Center for Digital Humanities @ Princeton" />
    </a>
</div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2022, Center for Digital Humanities @ Princeton.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 7.4.7</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 0.7.16</a>
      
    </div>

    

    
  </body>
</html>