{% extends 'base.html' %}
{% load static i18n humanize widget_tweaks render_bundle_csp %}

{% block meta_title %}{{ page_title }}{% endblock meta_title %}
{% block meta_description %}{{ page_description }}{% endblock meta_description %}
{% block extrascript %}
    {% render_bundle_csp "search" "js" attrs='defer' %}
{% endblock %}

{% block main %}
    <h1 class="sr-only">{{ page_title }}</h1>
    <form data-controller="search">
        <fieldset>
            {% render_field form.q data-search-target="query" data-action="input->search#updateSort change->search#submit" %}

            <details class="doctype-filter">
                <summary>
                    {{ form.doctype.label }}
                </summary>
                {{ form.doctype }}
            </details>

            <label for="{{ form.sort.html_name }}">
                {{ form.sort.label }}
            </label>
            <details class="sort-select" aria-expanded="false">
                <summary class="sort-select-trigger" data-search-target="sortlabel">
                    {% for choice in form.sort.field.choices %}
                        {% if form.sort.value == choice.0 %}
                            {{ choice.1 }}
                        {% endif %}
                    {% endfor %}
                    {# Translators: Button to open or close sort options menu #}
                    {% translate 'Toggle sort options menu' as toggle_label %}
                    <div role="button" tabindex="-1" aria-pressed="false" aria-expanded="false" aria-label="{{ toggle_label }}">
                        <span class="sr-only" >{{ toggle_label }}</span>
                    </div>
                </summary>
                {% render_field form.sort data-search-target="sort"  data-action="change->search#submit" %}
            </details>

            {# Translators: Search submit button #}
            {% translate 'Submit search' as search_label %}
            <button type="submit" aria-label="{{ search_label }}" />
        </fieldset>

        {% if form.errors %}
            <ul id="search-errors">
                {% for field, errors in form.errors.items %}
                    {# no clean way to get field labels here, so we just collapse the error lists #}
                    {% for error in errors %}
                        <li>{{ error }}</li>
                    {% endfor %}
                {% endfor %}
            </ul>
        {% endif %}
    </form>
    <section id="document-list">
        <h1>
            {% comment %}Translators: number of search results{% endcomment %}
            {% blocktranslate with count_humanized=paginator.count|intcomma count counter=paginator.count trimmed %}
                1 result
            {% plural %}
                {{ count_humanized }} total results
            {% endblocktranslate %}
        </h1>
        {% if is_paginated %}
            {% include "corpus/snippets/pagination.html" %}
        {% endif %}
        <ol>
            {% for document in documents %}
                {% include "corpus/snippets/document_result.html" %}
            {% endfor %}
        </ol>
        {% if is_paginated %}
            {% include "corpus/snippets/pagination.html" %}
        {% endif %}
    </section>
{% endblock main %}
