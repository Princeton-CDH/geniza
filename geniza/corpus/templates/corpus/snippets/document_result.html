{% load i18n corpus_extras %}
{% spaceless %}
    <li class="search-result">
        <section>
            {# title #}
            <h2 class="title">
                <span class="doctype">{{ document.type }}</span>
                <span class="shelfmark">{{ document.shelfmark|join:" + " }}</span>
            </h2>

            {# tags #}
            {% if document.tags %}
                {# Translators: label for tags on a document #}
                <h3 class="sr-only">{% translate 'Tags' %}</h3>
                <ul class="tags">
                    {% for tag in document.tags|alphabetize %}
                        <li>{{ tag }}</li>
                    {% endfor %}
                </ul>
            {% endif %}

            {# metadata #}
            <dl class="metadata">
                <dt>{% translate 'Input date' %}</dt>
                <dd>{{ document.input_year|default:'unknown' }}</dd>
                <dt>{% translate 'PGP ID' %}</dt>
                <dd>{{ document.pgpid }}</dd>
            </dl>

            {# description #}
            <p class="description">
                {# display keywords in context if any #}
                {% with document_highlights=highlighting|dict_item:document.id %}
                    {% if document_highlights.description_t %}
                        {% for snippet in document_highlights.description_t %}
                            {{ snippet|safe }}
                        {% endfor %}
                    {% else %}
                        {# otherwise, display truncated description #}
                        {{ document.description.0|truncatewords:25 }}
                    {% endif %}
                {% endwith %}
            </p>

            {# transcription: keywords in context if any, or excerpt #}
            {% with document_highlights=highlighting|dict_item:document.id %}
                {% if document_highlights.transcription_t %}
                    <p class="transcription">{% for snippet in document_highlights.transcription_t %}
                        {{ snippet|safe }}
                    {% endfor %}</p>
                {% else %}
                    {# otherwise, display truncated transcription #}
                    {# TODO: does truncate words remove newlines? can we split on lines instead? #}
                    <p class="transcription">{{ document.transcription.0|truncatechars:75 }}</p>
                {% endif %}
            {% endwith %}

            {# scholarship records #}
            <p class="scholarship">
                {% if document.scholarship_count %}
                    <i class="ph-check"></i>
                    {% if document.num_editions %}{% translate 'Transcription' %}{% if document.num_editions > 1 %} ({{ document.num_editions }}){% endif %}{% endif %}
                    {% if document.num_translations %}{% translate 'Translation' %}{% if document.num_translations > 1 %} ({{ document.num_translations }}){% endif %}{% endif %}
                    {% if document.num_discussions %}{% translate 'Discussion' %}{% if document.num_discussions > 1 %} ({{ document.num_discussions }}){% endif %}{% endif %}
                {% else %}
                    {% translate 'No Scholarship Records' %}
                {% endif %}
            </p>
        </section>
        {# view link #}
        <a class="view-link" href="{% url 'corpus:document' document.pgpid %}">
            {% translate 'View document details' %}
            <i class="ph-arrow-right"></i>
        </a>
    </li>
{% endspaceless %}
