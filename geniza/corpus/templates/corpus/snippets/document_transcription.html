{% load i18n static corpus_extras %}
<section id="itt-panel">
    {# NOTE: inputs must be kept as SIBLINGS of panel-container for CSS selection/controls #}
    {# images displayed by default; disable if no images are available #}
    {# translators: label for checkbox toggle to show the images panel for a document #}
    <input type="checkbox" id="images-on" aria-label="{% translate 'show images' %}" {% if document.has_image %}checked="true" {% else %} disabled="true"{% endif %}/>
    <label for="images-on"></label>
    {# transcription displayed by default; disable if no content is available #}
    {# translators: label for checkbox toggle to show the transcription panel for a document #}
    <input type="checkbox" id="transcription-on" aria-label="{% translate 'show transcription' %}" {% if document.digital_editions %}checked="true" {% else %} disabled="true"{% endif %}/>
    <label for="transcription-on"><svg><use xlink:href="{% static 'img/ui/all/all/transcription-toggle.svg' %}#transcription-toggle" /></svg></label>
    {# translation disabled for now since we don't handle them in the system yet #}
    {# translators: label for checkbox toggle to show the translation panel for a document #}
    <input type="checkbox" id="translation-on" aria-label="{% translate 'show translation' %}" disabled="true"/>
    <label for="translation-on"><svg><use xlink:href="{% static 'img/ui/all/all/translation-toggle.svg' %}#translation-toggle" /></svg></label>
    <div class="panel-container">
        {% comment %}
NOTE: if we have more transcription pages than images,
they won't show in current implementation.
May want to gather them in the model... (but transcription content format will change)
Also doesn't currently account for fragments without images.
        {% endcomment %}
        {# if we have images, loop based on them #}
        {% if document.iiif_urls %}
            {% for image_info in document.iiif_images %}
                <div class="img">
                    <h3>{{ image_info.shelfmark }} {{ image_info.label }}</h3>
                    <img src="{{ image_info.image|iiif_image:"size:width=500" }}" alt="{{ image_info.label }}" title="{{ image_info.label }}" loading="lazy"
                        sizes="(max-width: 650px) 50vw, 94vw"
                        srcset="{{ image_info.image|iiif_image:"size:width=300" }} 300w,
                        {{ image_info.image|iiif_image:"size:width=500" }} 500w,
                        {{ image_info.image|iiif_image:"size:width=640" }} 640w,
                        {{ image_info.image|iiif_image:"size:width=1000" }} 1000w">
                </div>
                <div class="transcription">
                    {% if forloop.first %}<h3>Transcription</h3>{% endif %}
                    {# display transcription in chunks by index #}
                    <div>{{ document.digital_editions.0.content.html|index:forloop.counter0|h1_to_h3|safe }}</div>
                </div>
            {% endfor %}
            {# if there are no images, loop based on the transcription chunks instead #}
        {% elif document.has_transcription %}
            {% for chunk in document.digital_editions.0.content.html %}
                <div class="img"></div> {# empty image div needed for grid layout #}
                <div class="transcription">
                    {% if forloop.first %}<h3>Transcription</h3>{% endif %}
                    {# display transcription in chunks based on loop index #}
                    <div>{{ chunk|h1_to_h3|safe }}</div>
                </div>
            {% endfor %}
        {% endif %}
        {% if document.has_image %}
            {% include "corpus/snippets/document_image_rights.html" %}
        {% endif %}
    </div>

</section>

{% comment %}
<hr/>
OLD panel


<section id="iiif-viewer" data-controller="iiif">
    {% if user.is_authenticated %} {# TODO: determine proper permission to check here #}
        <button id="enable-annotation"><i class="ph-pencil"></i> transcribe</button>
    {% endif %}
    <h1 class="sr-only">
        {# Translators: accessibility label for document images and transcription section #}
        {% translate "Images and transcription" %}
    </h1>
    {% if document.has_image %}
        <noscript>
            <ol id="iiif-images-fallback">
                {% for image_dict in document.iiif_images %}
                    <li id="image-{{ forloop.counter }}">
                        <a href="{{ image_dict.image|iiif_image:"size:width=2880" }}">
                            <img src="{{ image_dict.image|iiif_image:"size:width=500" }}" alt="{{ image_dict.label }}" title="{{ image_dict.label }}" loading="lazy">
                        </a>
                    </li>
                {% endfor %}
            </ol>
        </noscript>
        <div id="iiif-images" data-iiif-target="iiifContainer" data-iiif-urls="{{ document.iiif_images|iiif_info_json }}" class="{% if not document.has_transcription %}no-transcription{% endif %}">
        </div>
    {% endif %}
    <div class="transcription{% if not document.has_image %} no-image{% endif %}{% if not document.has_transcription %} no-transcription{% endif %}">
        <h2>{% translate 'Transcription' %}</h2>
        {% if document.digital_editions|length > 1 %}
            {# when there are multiple editions, use disclosure element #}
            {% for edition in document.digital_editions %}
                <details open>
                    <summary class="source">{{ edition.source.display }}</summary>
                    <div>{{ edition.content.html|h1_to_h3|safe }}</div>
                </details>
            {% endfor %}
        {% else %}
            <div>{{ document.digital_editions.0.content.html|h1_to_h3|safe }}</div>
        {% endif %}
    </div>
    {% if user.is_authenticated %} {# TODO: determine proper permission to check here #}
        <div class="annotate" data-manifest="{% url 'corpus:document-manifest' document.pk %}">
            <h2>Transcribe</h2>
            <p class="instructions">Hold shift and then click on the image and drag
                to select a rectangular region for the block text you want to transcribe.</p>
            {{ annotation_config|json_script:"annotation-config" }}
        </div>
    {% endif %}
</section>
{% endcomment %}
