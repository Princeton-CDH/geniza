// -----------------------------------------------------------------------------
// Main site navigation that appears on every page.
// -----------------------------------------------------------------------------

@use "../base/breakpoints";
@use "../base/colors";
@use "../base/spacing";
@use "../base/typography";

// Header backgrounds for light and dark mode, mobile
@mixin header-background-mobile {
    background: url("/static/img/header-base-mobile-lightmode.svg"),
        linear-gradient(to right, rgba(255, 255, 255, 0), white 20rem),
        url("/static/img/header-image-mobile-lightmode.png");
    background-repeat: no-repeat, no-repeat, no-repeat;
    @media (prefers-color-scheme: dark) {
        background: url("/static/img/header-base-mobile-darkmode.svg"),
            linear-gradient(to right, rgba(22, 22, 22, 0), colors.$black 20rem),
            url("/static/img/header-image-mobile-darkmode.png");
        background-repeat: no-repeat, no-repeat, no-repeat;
    }
    @include breakpoints.for-tablet-landscape-up {
        background: none;
    }
}

// Header backgrounds for light and dark mode, desktop
@mixin header-background-desktop {
    background: url("/static/img/header-base-desktop-lightmode.svg"),
        linear-gradient(to right, rgba(255, 255, 255, 0), white 90rem),
        url("/static/img/header-image-desktop-lightmode.png");
    background-repeat: no-repeat, no-repeat, no-repeat;
    @media (prefers-color-scheme: dark) {
        background: url("/static/img/header-base-desktop-darkmode.svg"),
            linear-gradient(to right, rgba(22, 22, 22, 0), colors.$black 90rem),
            url("/static/img/header-image-desktop-darkmode.png");
        background-repeat: no-repeat, no-repeat, no-repeat;
    }
}

.site-nav {
    // background image and gradient
    @include header-background-mobile;
    display: flex;
    flex-flow: row wrap;
    @include breakpoints.for-tablet-landscape-up {
        @include header-background-desktop;
        flex-flow: row nowrap;
        align-items: center;
        justify-content: space-between;
        height: 12rem;
        padding-bottom: 4rem;
    }
    // Logotype, links to homepage
    a.home-link {
        display: inline-block;
        vertical-align: bottom;
        svg {
            @include colors.apply-theme("logo", "fill");
        }
    }
    a.home-link,
    a.home-link svg {
        width: 6.25rem;
        height: 2.8rem;
        @include breakpoints.for-tablet-landscape-up {
            width: 12.5rem;
            height: 5.625rem;
        }
    }
    // Mobile-only menu buttons
    li.menu-button {
        display: block;
        a {
            display: flex;
            text-decoration: none;
            width: 3rem;
            height: 3rem;
            align-items: center;
            justify-content: center;
            @include typography.icon-button;
            @include colors.apply-theme("on-background");
        }
    }
    // Top-left corner links: home and open menu button
    ul#corner-links {
        display: flex;
        flex-flow: row wrap;
        align-items: center;
        height: 9rem;
        margin-left: spacing.$spacing-md;
        @include breakpoints.for-tablet-landscape-up {
            height: auto;
            margin: spacing.$spacing-2xl 0 0 spacing.$spacing-lg;
            padding-top: spacing.$spacing-sm;
        }
        li {
            margin-top: -#{spacing.$spacing-3xl};
        }
        li.menu-button {
            margin-left: spacing.$spacing-sm;
            a::before {
                font-family: "Phosphor";
                content: "\f1fa";
            }
        }
    }
    // List of links in main nav bar
    ul#menu {
        // Takes up full screen on mobile
        @include header-background-mobile;
        display: flex;
        left: calc(-100vw);
        transition: left 0.5s;
        position: fixed;
        flex-flow: row wrap;
        align-items: center;
        justify-content: flex-end;
        padding: 0;
        max-width: 100%;
        width: 100%;
        height: 100vh;
        z-index: 100;
        @include colors.apply-theme("background", "background-color");
        // Direct descendent menu buttons (mobile)
        & > li.menu-button {
            display: flex;
            margin-right: spacing.$spacing-xs;
        }
        li.menu-button a::before {
            font-family: "Phosphor";
            content: "\f36d"; // phosphor X icon
        }
        // All descendent menu buttons/labels (mobile)
        li.menu-button,
        li.menu-label {
            height: 4rem;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
        }
        // First item after menu button should get extra space, and no border-top
        li.menu-button + li.menu-item a {
            padding-top: spacing.$spacing-2xl;
            border-top: none;
            @include breakpoints.for-tablet-landscape-up {
                padding-top: 0;
            }
        }
        // Move into view on :target with link to #ID
        &:target {
            left: 0;
            pointer-events: all;
            @include breakpoints.for-tablet-landscape-up {
                flex: 1 0 auto;
                left: auto;
                transition: none;
            }
        }
        // Positioning for desktop
        @include breakpoints.for-tablet-landscape-up {
            display: flex;
            background: none;
            height: auto;
            transition: none;
            left: auto;
            position: relative;
            flex: 1 0 auto;
            flex-flow: row nowrap;
            justify-content: flex-end;
            width: auto;
            margin: 0 spacing.$spacing-4xl 0 spacing.$spacing-xl;
            pointer-events: all;
            & > li.menu-item + li.menu-item {
                margin-left: spacing.$spacing-lg;
            }
        }
    }

    // Individual menu items
    li.menu-item,
    ul.sub-menu li.menu-item {
        flex: 1 0 100%;
        max-width: 100%;
        // Mobile links which need padding, inline-block, and border-top
        a {
            text-decoration: none;
            padding: spacing.$spacing-lg spacing.$spacing-sm spacing.$spacing-lg;
            width: 100%;
            max-width: 100%;
            display: inline-block;
            @include typography.nav-link;
            @include typography.mobile-menu;
        }
        & + li.menu-item a,
        & + ul.sub-menu li.menu-item a {
            border-top: 1px solid colors.$gray;
            @include breakpoints.for-tablet-landscape-up {
                padding-top: 0;
                border: none;
            }
        }
        // Last item in list should take up entire remaining vertical space
        &:last-child {
            height: 100%;
        }
        // "Open sub-menu" style on mobile
        &.has-submenu a.open-sub-menu {
            display: flex;
            flex-flow: row nowrap;
            align-items: center;
            justify-content: space-between;
            padding-top: spacing.$spacing-sm;
            &::after {
                font-family: "Phosphor";
                content: "\f0c4"; // phosphor caret-right icon
                @include typography.icon-button;
            }
            ul {
                display: none;
                position: absolute;
            }
            &:hover ul {
                display: block;
            }
        }
        @include breakpoints.for-tablet-landscape-up {
            // desktop links (strip some mobile styles)
            flex: 0 0 auto;
            padding: spacing.$spacing-lg 0 spacing.$spacing-xs;
            min-width: 117px; // Width of the hover indicator
            a {
                display: flex;
                align-items: center;
                justify-content: flex-end;
                border: none;
                padding: 0 spacing.$spacing-md 0 0;
            }
            // "Open sub-menu" link on desktop
            &.has-submenu {
                height: auto;
                a.open-sub-menu {
                    justify-content: flex-end;
                    padding: 0 spacing.$spacing-sm 0 0;
                    &::after {
                        font-family: "Phosphor";
                        content: "\f0c2"; // phosphor caret-down icon
                        margin-left: spacing.$spacing-xs;
                        padding: 0;
                        font-size: typography.$text-size-2xl;
                    }
                }
            }
        }
    }
    // Sub-navigation menus (i.e. nested list)
    ul.sub-menu {
        // Sub menu mobile view
        @include header-background-mobile;
        display: flex;
        left: calc(100vw);
        transition: left 0.5s;
        position: fixed;
        top: 0;
        flex-flow: row wrap;
        align-items: center;
        justify-content: space-between;
        flex: 1 0 100%;
        padding: 0;
        max-width: 100%;
        width: 100%;
        height: 100vh;
        li.menu-button {
            display: inline-block;
            width: auto;
            padding: 0 spacing.$spacing-sm 0 spacing.$spacing-2xs;
            a {
                display: flex;
                text-decoration: none;
                padding: 0;
                width: auto;
                border: none;
                @include typography.icon-button;
            }
            a#back-to-main-menu::before {
                font-family: "Phosphor";
                content: "\f0c3"; // phosphor caret-left icon
                @include typography.icon-button;
            }
        }
        li.menu-label {
            display: inline-block;
            flex: 1 0 auto;
            @include typography.nav-link;
            @include typography.mobile-menu;
        }
        &:target {
            left: 0;
            @include breakpoints.for-tablet-landscape-up {
                transition: none;
                left: auto;
            }
        }
        // Sub menu (floating) desktop view
        @include breakpoints.for-tablet-landscape-up {
            display: none;
            left: auto;
            transition: none;
            flex: 1 0 auto;
            position: absolute;
            white-space: nowrap;
            width: auto;
            height: auto;
            padding: spacing.$spacing-xl 0 spacing.$spacing-sm;
            // Hack to look like submenu is layered underneath the menu
            top: 104px;
            background: linear-gradient(
                to bottom,
                rgba(86, 120, 86, 0.05),
                rgba(255, 255, 255, 0.2) 1rem
            );
            @media (prefers-color-scheme: dark) {
                background: linear-gradient(
                    to bottom,
                    rgba(255, 255, 255, 0.16),
                    rgba(255, 255, 255, 0) 17px
                );
            }
            // TODO: Replace with mixin/vars
            box-shadow: 0px 2px 4px rgba(86, 120, 86, 0.8);
            @media (prefers-color-scheme: dark) {
                box-shadow: 0px 2px 4px rgba(255, 255, 255, 0.3);
            }
            li.menu-item {
                padding: 0;
                a[role="menuitem"] {
                    padding: 0 spacing.$spacing-md;
                    margin-bottom: -#{spacing.$spacing-2xs};
                    justify-content: flex-start;
                }
            }
        }
        @include colors.apply-theme("background", "background-color");
    }
    div.sub-menu-overlay {
        display: none;
        @include breakpoints.for-tablet-landscape-up {
            display: none;
        }
    }
    // Overlay to keep sub menu open on desktop when moving mouse
    a.open-sub-menu:hover + span + div.sub-menu-overlay,
    li:hover div.sub-menu-overlay,
    li.has-submenu.open div.sub-menu-overlay {
        opacity: 0;
        display: block;
        width: 100%;
        height: 32px;
        margin-bottom: -31.5px;
    }

    // Keep sub menu open on desktop when hovering
    a.open-sub-menu:hover + span + div + ul.sub-menu,
    div.sub-menu-overlay:hover + ul.sub-menu,
    li:hover ul.sub-menu,
    ul.sub-menu:hover,
    li.has-submenu.open ul.sub-menu {
        @include breakpoints.for-tablet-landscape-up {
            display: block;
        }
    }

    // Currently active page
    a[aria-current="page"] {
        @include typography.nav-bold;
        @include typography.mobile-menu;
    }
    // Hide mobile menu buttons and labels in desktop
    li.menu-button,
    li.menu-label,
    ul#menu li.menu-button,
    ul#menu li.menu-label,
    ul#menu:target li.menu-button,
    ul#menu:target li.menu-label,
    ul#about-menu:target li.menu-button,
    ul#about-menu:target li.menu-label {
        @include breakpoints.for-tablet-landscape-up {
            display: none;
        }
    }
    // Hover indicator for nav links
    a + span.hover-indicator {
        display: none;
        @include breakpoints.for-tablet-landscape-up {
            display: block;
            width: 100%;
            height: 16px;
            background: url("/static/img/hover-main-menu-desktop-lightmode.svg")
                top;
            opacity: 0;
            transition: opacity 0.2s;
            @media (prefers-color-scheme: dark) {
                background: url("/static/img/hover-main-menu-desktop-darkmode.svg")
                    top;
            }
        }
    }
    a:hover + span.hover-indicator,
    a[aria-current="page"] + span.hover-indicator {
        @include breakpoints.for-tablet-landscape-up {
            opacity: 100%;
        }
    }
    // Gets cluttered in sub-menu, so only show when hovering
    ul.sub-menu {
        @include breakpoints.for-tablet-landscape-up {
            a[aria-current="page"] + span.hover-indicator {
                opacity: 0%;
            }
            a:hover + span.hover-indicator {
                opacity: 100%;
            }
        }
    }
}
